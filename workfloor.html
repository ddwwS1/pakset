<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factory Floor Management System</title>
    <link rel="icon" type="image/png" href="assets/icons/logos/PAKSET-black-logo-e.png">
    <link rel="stylesheet" href="css/workfloor.css">
</head>
<body>
    <div class="app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <img class="header-logo" src="assets/icons/logos/PAKSET-black-logo-e.png" alt="Pakset logo">
                <div class="header-text">
                    <h1>Factory Floor Management System</h1>
                    <p>Monitor and manage machines, workers, and floor operations</p>
                </div>
            </div>

            <!-- Debug / Schedule Fetch Info -->
            <div class="debug-panel" id="shiftDebug" style="display:none;">
                <button class="debug-close" id="shiftDebugClose">✕</button>
                <strong>Schedule debug:</strong>
                <pre id="shiftDebugPre" style="white-space:pre-wrap;">(no data)</pre>
            </div>

            <!-- Shift Progress Bar -->
            <div class="shift-progress-container">
                <div class="shift-info">
                    <div class="shift-left">
                        <span class="shift-label">Current Shift Progress</span>
                        <span class="shift-next" id="nextShiftIn">Next shift in: —</span>
                    </div>
                    <div style="text-align:right;">
                        <div class="shift-name-small" id="shiftName">—</div>
                        <div class="shift-time" id="shiftTime">Start: —  End: —</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="progress-overtime-area" id="progressOvertimeArea"></div>
                    <div class="progress-overtime-fill" id="progressOvertimeFill"></div>
                    <div class="progress-pulse" aria-hidden="true"></div>
                    <svg id="progressSeamSvg" aria-hidden="true" class="progress-seam-svg" viewBox="0 0 64 100" preserveAspectRatio="none">
                        <defs>
                            <linearGradient id="seamGrad" x1="0" x2="1" y1="0" y2="0">
                                <!-- Wider transparent padding + stronger yellow band -->
                                <stop offset="0%" stop-color="#4299e1" stop-opacity="0" />
                                <stop offset="42%" stop-color="#4299e1" stop-opacity="0" />
                                <stop offset="52%" stop-color="#4299e1" stop-opacity="0.7" />
                                <stop offset="60%" stop-color="#4299e1" stop-opacity="0.35" />
                                <stop offset="60%" stop-color="#fde047" stop-opacity="1" />
                                <stop offset="66%" stop-color="#fde047" stop-opacity="1" />
                                <stop offset="72%" stop-color="#fde047" stop-opacity="1" />
                                <stop offset="73%" stop-color="#fb923c" stop-opacity="0.6" />
                                <stop offset="84%" stop-color="#fb923c" stop-opacity="0.2" />
                                <stop offset="92%" stop-color="#fb923c" stop-opacity="0" />
                                <stop offset="100%" stop-color="#fb923c" stop-opacity="0" />
                            </linearGradient>
                            <filter id="seamBlur">
                                <feGaussianBlur stdDeviation="14" />
                            </filter>
                        </defs>
                        <rect x="0" y="0" width="64" height="100" fill="url(#seamGrad)" filter="url(#seamBlur)" rx="8" />
                    </svg>
                </div>
            </div>

            <!-- Schedule Loader (collapsible) -->
            <div class="section-card" style="margin-bottom:16px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div style="display:flex;align-items:center;gap:12px;">
                        <button id="scheduleToggleBtn" class="icon-btn" aria-expanded="false">
                            <svg id="scheduleIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                                <path d="M8 2v4"></path>
                            </svg>
                            <span style="color:#2d3748;font-weight:600;margin-left:6px;">Schedules</span>
                        </button>
                        <div style="color:#718096;font-size:14px;">View and load schedules</div>
                    </div>
                    <div>
                        <button id="loadScheduleBtn" class="form-btn form-btn-primary">Load</button>
                    </div>
                </div>

                <div id="schedulePanel" style="margin-top:12px;display:none;">
                    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px;">
                        <label style="color:#718096;font-size:14px;">Range:</label>
                        <input type="date" id="scheduleStart" class="form-input" style="max-width:160px;">
                        <input type="date" id="scheduleEnd" class="form-input" style="max-width:160px;">
                    </div>
                    <div id="scheduleContainer" style="margin-top:6px;"></div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <!-- Edit Mode Toggle -->
                <div class="stat-card clickable" id="editModeToggle">
                    <div class="stat-content">
                        <div class="stat-icon" id="editIcon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="stat-label">Edit Mode</p>
                            <p class="stat-value" id="editModeText">OFF</p>
                        </div>
                    </div>
                </div>

                <!-- Running Machines -->
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon stat-icon-inset">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                        </div>
                        <div>
                            <p class="stat-label">Running</p>
                            <p class="stat-value" id="runningCount">0</p>
                        </div>
                    </div>
                </div>

                <!-- Total Workers -->
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon stat-icon-inset">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="stat-label">Workers</p>
                            <p class="stat-value" id="workerCount">0</p>
                        </div>
                    </div>
                </div>

                <!-- Maintenance -->
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon stat-icon-inset">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fb923c" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                        </div>
                        <div>
                            <p class="stat-label">Maintenance</p>
                            <p class="stat-value" id="maintenanceCount">0</p>
                        </div>
                    </div>
                </div>

                <!-- Avg Efficiency -->
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon stat-icon-inset">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                        </div>
                        <div>
                            <p class="stat-label">Avg Efficiency</p>
                            <p class="stat-value" id="avgEfficiency">0%</p>
                        </div>
                    </div>
                </div>

                <!-- Add Machine -->
                <div class="stat-card clickable" id="addMachineCard">
                    <button class="add-btn" id="addMachineBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        <span>Add Machine</span>
                    </button>
                    <div class="add-machine-form" id="addMachineForm" style="display: none;">
                        <input type="text" id="machineName" placeholder="Machine name" class="form-input">
                        <select id="machineBrand" class="form-input">
                            <option value="jsw">jsw (1)</option>
                            <option value="bmb">bmb hybrid</option>
                        </select>
                        <select id="machineModel" class="form-input">
                            <!-- populated by JS based on brand -->
                        </select>
                        <div class="form-buttons">
                            <button class="form-btn form-btn-primary" id="addMachineConfirm">Add</button>
                            <button class="form-btn form-btn-secondary" id="addMachineCancel">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="main-grid">
                <!-- Factory Floor Map -->
                <div class="factory-floor-section">
                    <div class="section-card">
                        <div class="section-header">
                            <h2>Factory Floor</h2>
                            <button class="icon-btn" id="addTagBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                <span id="addTagText">Add Tag</span>
                            </button>
                        </div>
                        <div class="factory-floor-map" id="factoryFloorMap">
                            <!-- Room boxes will be added by JS -->
                            <div id="roomsContainer"></div>
                            <!-- Machines and tags will be added by JS -->
                        </div>
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-dot" style="background: #10b981;"></div>
                                <span>Running</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot" style="background: #fbbf24;"></div>
                                <span>Idle</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot" style="background: #fb923c;"></div>
                                <span>Maintenance</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot" style="background: #ef4444;"></div>
                                <span>Offline</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Machines List -->
                <div class="machines-section">
                    <div class="section-card">
                        <div class="section-header">
                            <h2>Machines</h2>
                        </div>
                        <div class="scrollable-list" id="machinesList">
                            <!-- Machines will be added by JS -->
                        </div>
                    </div>
                </div>

                <!-- Workers Panel -->
                <div class="workers-section">
                    <div class="section-card">
                        <div class="section-header">
                            <h2>Workers</h2>
                            <button class="icon-btn" id="addWorkerBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                <span>Add Worker</span>
                            </button>
                        </div>
                        <div class="scrollable-list" id="workersList">
                            <!-- Workers will be added by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/workfloor.js"></script>
</body>
</html>